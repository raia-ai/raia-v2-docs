# Microsoft Teams Integration

## Build an Azure Bot That Connects to a raia Agent in Microsoft Teams

This guide walks you through creating an **Azure Bot** and wiring it to a **raia Agent** so it can actively participate in **Microsoft Teams chats**.

The approach is intentionally lightweight:

* Azure Bot Service handles Teams connectivity
* **n8n** acts as the middleware
* raia handles the intelligence and response logic

The screenshots you’ve seen cover **Phase 1: Azure Bot setup**. This article stitches everything together into a clear, repeatable workflow.

***

### Architecture Overview

**Flow at a glance:**

Microsoft Teams → Azure Bot Service → n8n Webhook → raia Agent → n8n → Azure Bot → Microsoft Teams

Key responsibilities:

* **Azure Bot**: Auth, Teams channel, conversation routing
* **Microsoft Entra App**: Secure identity + OAuth
* **n8n**: Message processing and response delivery
* **raia Agent**: Generates the response content

***

### Prerequisites

Before starting, make sure you have:

* An Azure subscription
* Access to Microsoft Teams
* An n8n instance (cloud or self-hosted)
* A raia Agent ready to receive and respond to messages
* Permission to create apps in **Microsoft Entra ID**

***

### Phase 0: Create a Microsoft Entra Application (Required)

> ⚠️ This step is critical. The Azure Bot depends on an Entra App for authentication.

1. Go to **Microsoft Entra ID** in the Azure Portal
2. Navigate to **App registrations → New registration**
3. Configure:
   * **Name**: `raia-teams-agent`
   * **Supported account types**: Single tenant
   * Redirect URI: _Leave blank_
4. Click **Register**

After creation, capture the following values (you will need them later):

* **Application (client) ID**
* **Directory (tenant) ID**

#### Create a Client Secret

1. In the app, go to **Certificates & secrets**
2. Click **New client secret**
3. Copy the secret value immediately

You now have:

* `client_id`
* `client_secret`
* `tenant_id`

***

### Phase 1: Create the Azure Bot

#### Step 1: Create the Bot Resource

1. In Azure Portal, search for **Azure Bot**
2. Click **Create**
3. Configure:
   * **Bot handle**: `raia-teams-agent`
   * **Subscription**: Your Azure subscription
   * **Resource group**: Create new (e.g. `raia-group`)
   * **Region**: East US (or your preference)
   * **Data residency**: Global

#### Step 2: Bot Configuration

* **Type of App**: Single Tenant
* **Microsoft App ID**: Use _existing app registration_
* Select the Entra App you created earlier

Complete **Review + Create** and deploy the bot.

Once deployment completes, click **Go to resource**.

***

### Phase 2: Capture Required Bot Values

In the Azure Bot resource:

1. Go to **Settings → Configuration**
2. Capture:
   * **Microsoft App ID**
   * **App Tenant ID**

You’ll use these values in n8n for OAuth token generation.

***

### Phase 3: Configure n8n Workflow

This workflow receives Teams messages, authenticates with Azure, and posts responses back.

#### Step 1: Create Webhook Node

* **Method**: POST
* **Name**: `Webhook`
* **Respond**: Immediately

This will be your Azure Bot **Messaging Endpoint** later.

***

#### Step 2: Filter Only Message Events

Add an **IF** node:

*   Condition:

    ```
    {{ $json.body.type }} equals message
    ```

Only continue when the event is a message.

***

#### Step 3: Get Bot Framework Access Token

Add an **HTTP Request** node (Token Request):

* **Method**: POST
*   **URL**:

    ```
    https://login.microsoftonline.com/{APP_TENANT_ID}/oauth2/v2.0/token
    ```
* **Authentication**: None
* **Send Body**: Form URL Encoded

**Fields:**

```
grant_type=client_credentials
client_id={FROM ENTRA APP}
client_secret={FROM ENTRA APP}
scope=https://api.botframework.com/.default
```

The response will return:

```
access_token
```

***

#### Step 4: Send Message Back to Teams

Add another **HTTP Request** node (Send Activity):

* **Method**: POST
*   **URL**:

    ```
    {{ $('Webhook').item.json.body.serviceUrl }}v3/conversations/{{ $('Webhook').item.json.body.conversation.id }}/activities
    ```
* **Authentication**: None

**Headers:**

```
Authorization=Bearer {access_token}
Content-Type=application/json
```

**Body**: JSON (see below)

***

### Fig. 1 – JSON Body for Posting a Message

```json
{
  "type": "message",
  "from": {
    "id": "{{ $('Webhook').item.json.body.recipient.id }}",
    "name": "{{ $('Webhook').item.json.body.recipient.name }}"
  },
  "recipient": {
    "id": "{{ $('Webhook').item.json.body.from.id }}"
  },
  "conversation": {
    "id": "{{ $('Webhook').item.json.body.conversation.id }}"
  },
  "text": "Hello from raia."
}
```

At this point, replace the `text` value with the response generated by your **raia Agent**.

***

### Phase 4: Connect Azure Bot to n8n

1. Return to **Azure Bot → Settings → Configuration**
2. Set:
   * **Messaging Endpoint** = `{YOUR_N8N_WEBHOOK_URL}`
3. Click **Apply**

Azure will immediately begin sending Teams events to n8n.

***

### Phase 5: Enable Microsoft Teams Channel

1. In Azure Bot, go to **Channels**
2. Add **Microsoft Teams**
3. Save

Your bot can now be added to Teams chats, channels, and meetings.

***

### &#x20;
